<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="FinStmt">

	<resultMap type="IncomeStmtAccount" id="IncomeStmtResultSet">
		<result property="price" column="PRICE"/>
		<result property="accountCode" column="ACCOUNT_CODE"/>
	</resultMap>

	<insert id="insertIncomeStmt" parameterType="IncomeStmt">
		INSERT INTO INCOME_STMT(INCOME_STMT_CODE, COM_CODE, YEAR, TERM, SALES, ENDING_INV_OF_MERCHANDISE) 
		VALUES(SEQ_INCOME_STMT_CODE.NEXTVAL, #{comCode}, #{year}, #{term}, #{sales}, #{endingInvOfMerchandise})
	</insert>

	<select id="selectCurIncomeStmt" parameterType="IncomeStmtAccount" resultMap="IncomeStmtResultSet">
		SELECT J.PRICE, J.ACCOUNT_CODE
		FROM SLIP S
		LEFT JOIN JOURNALIZE J ON(S.SLIP_CODE = J.SLIP_CODE)
		WHERE TO_CHAR(S.SLIP_DATE, 'YYYY') = #{year}
		AND TO_NUMBER(TO_CHAR(S.SLIP_DATE, 'MM')) <![CDATA[<=]]> #{month}
		AND COM_CODE = #{comCode}
	</select>

	<select id="selectPastIncomeStmt" parameterType="IncomeStmtAccount" resultMap="IncomeStmtResultSet">
		SELECT J.PRICE, J.ACCOUNT_CODE
		FROM SLIP S
		LEFT JOIN JOURNALIZE J ON(S.SLIP_CODE = J.SLIP_CODE)
		WHERE TO_CHAR(S.SLIP_DATE, 'YYYY') = #{year} - 1
		AND TO_NUMBER(TO_CHAR(S.SLIP_DATE, 'MM')) <![CDATA[<=]]> #{month}
		AND COM_CODE = #{comCode}
	</select>

</mapper>