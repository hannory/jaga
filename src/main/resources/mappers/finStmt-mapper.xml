<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="FinStmt">

<!-- 	<resultMap type="IncomeStmtAccount" id="IncomeStmtResultSet">
		<result property="price" column="PRICE"/>
		<result property="accountCode" column="ACCOUNT_CODE"/>
	</resultMap> -->
	
	<insert id="insertIncomeStmt" parameterType="IncomeStmt">
		INSERT INTO INCOME_STMT(INCOME_STMT_CODE, COM_CODE, YEAR, TERM, CLOSING, SUM10, V40100, VAL213, SUM30, SUM40, SUM50, SUM100) 
		VALUES(SEQ_INCOME_STMT_CODE.NEXTVAL, #{comCode}, #{year}, #{term}, #{closing}, #{sum10}, #{v40100}, #{val213}, #{sum30}, #{sum40}, #{sum50}, #{sum100})
	</insert>

	<!-- (거래처 미입력 등) 분개가 제대로 안되어 NULL 값이 나오는 경우가 있어 RIGHT JOIN -->
	<select id="selectCurFinStmt" parameterType="IncomeStmtAccount" resultType="IncomeStmtAccount">
		SELECT J.PRICE, J.ACCOUNT_CODE, J.DEBIT_CREDIT
		FROM SLIP S
		RIGHT JOIN JOURNALIZE J ON(S.SLIP_CODE = J.SLIP_CODE)
		WHERE TO_CHAR(S.SLIP_DATE, 'YYYY') = #{year}
		AND TO_NUMBER(TO_CHAR(S.SLIP_DATE, 'MM')) <![CDATA[<=]]> #{month}
		AND COM_CODE = #{comCode}
	</select>
	
	<select id="selectPastFinStmt" parameterType="IncomeStmtAccount" resultType="IncomeStmtAccount">
		SELECT J.PRICE, J.ACCOUNT_CODE, J.DEBIT_CREDIT
		FROM SLIP S
		RIGHT JOIN JOURNALIZE J ON(S.SLIP_CODE = J.SLIP_CODE)
		WHERE TO_CHAR(S.SLIP_DATE, 'YYYY') = #{year} - 1
		AND TO_NUMBER(TO_CHAR(S.SLIP_DATE, 'MM')) <![CDATA[<=]]> #{month}
		AND COM_CODE = #{comCode}
	</select>

	<select id="selectSlip" parameterType="IncomeStmtAccount" resultType="IncomeStmtAccount">
		SELECT S.SLIP_DATE, S.DATE_SLIP_CODE, S.BRIEF, J.VENDER_CODE, V.VENDER_NAME, J.DEBIT_CREDIT, J.PRICE, A.ACCOUNT_TITLE 
		FROM SLIP S
		RIGHT JOIN JOURNALIZE J ON(S.SLIP_CODE = J.SLIP_CODE)
		LEFT JOIN VENDER V ON(J.VENDER_CODE = V.VENDER_CODE)
		LEFT JOIN ACCOUNT_TITLE A ON(J.ACCOUNT_CODE = A.ACCOUNT_CODE)
		WHERE TO_CHAR(S.SLIP_DATE, 'YYYY') = #{year}
		AND TO_NUMBER(TO_CHAR(S.SLIP_DATE, 'MM')) <![CDATA[<=]]> #{month}
		AND S.COM_CODE = #{comCode}
		AND J.ACCOUNT_CODE = #{accountCode}
		ORDER BY S.SLIP_DATE
	</select>
	
	<insert id="insertMfrgStmt" parameterType="MfrgStmt">
		INSERT INTO MFRG_STMT(MFRG_STMT_CODE, COM_CODE, YEAR, TERM, CLOSING, VAL13, SUM90)
		VALUES(SEQ_MFRG_STMT_CODE.NEXTVAL, #{comCode}, #{year}, #{term}, #{closing}, #{val13}, #{sum90})
	</insert>
	
	<select id="countMfrgStmt" parameterType="MfrgStmt" resultType="_int">
		SELECT COUNT(*)
		FROM MFRG_STMT
		WHERE COM_CODE = #{comCode}
		AND YEAR = #{year}
	</select>
	
	<update id="updateMfrgStmt" parameterType="MfrgStmt">
		UPDATE MFRG_STMT
		SET VAL13 = #{val13}, SUM90 = #{sum90}, CLOSING = #{closing}
		WHERE COM_CODE = #{comCode}
		AND YEAR = #{year}
	</update>
	
	<select id="searchMfrg" parameterType="MfrgStmt" resultType="MfrgStmt">
		SELECT VAL13, CLOSING
		FROM MFRG_STMT
		WHERE COM_CODE = #{comCode}
		AND YEAR = #{year}
	</select>

	<select id="selectMfrgSum90" parameterType="IncomeStmtAccount" resultType="_int">
		SELECT SUM90
		FROM MFRG_STMT
		WHERE COM_CODE = #{comCode}
		AND YEAR = #{year}
	</select>
	
</mapper>








